{"id":1097,"date":"2020-09-28T17:27:06","date_gmt":"2020-09-28T17:27:06","guid":{"rendered":"http:\/\/reproducibility.stanford.edu\/?p=1097"},"modified":"2024-12-04T18:37:37","modified_gmt":"2024-12-04T18:37:37","slug":"fmriprep-lts","status":"publish","type":"post","link":"https:\/\/reproducibility.stanford.edu\/fmriprep-lts\/","title":{"rendered":"fMRIPrep: Versioning and Long-Term Support"},"content":{"rendered":"<h2 id=\"-fmriprep-versioning-and-long-term-support\"><em>fMRIPrep<\/em>: Versioning and Long-Term Support<\/h2>\n<p>As <em>fMRIPrep<\/em> continues to mature, we at the development team would like to take a moment to look at where we&#8217;ve been and where we&#8217;re going. Its mission of producing &#8220;analysis-grade&#8221; (or &#8220;sushi-grade&#8221;) data has proven useful, as evident by the sizeable amount of adoption within the brain-MRI community, and has spawned similar efforts generalizable to other modalities (<a href=\"https:\/\/www.nipreps.org\">NeuroImaging PREProcessing toolS, or <em>NiPreps<\/em><\/a>). However, like with most other software, this increase in users usually follows with an increase of new challenges. In this blog post, we&#8217;ll touch upon some of these issues (consistency among versions, and long-term support) and what we&#8217;re doing to address them.<\/p>\n<h3 id=\"versioning-updates\">Versioning updates<\/h3>\n<p>A guiding principle of <em>fMRIPrep<\/em>&#8216;s development has been <a href=\"https:\/\/en.wikipedia.org\/wiki\/Release_early%2C_release_often\"><em>release early, release often (RERO)<\/em><\/a>. This philosophy promotes rapid progress, as users do not have to wait long for bug-fixes or new features and improvements. In turn, this also helps conform the software to users&#8217; specifications, and over the years user feedback has greatly driven <em>fMRIPrep<\/em> to where it is now. However, this has resulted in a magnitude of releases throughout the years (about <strong>145<\/strong> since May 2016!)<\/p>\n<p>Earlier this year, we adopted the <a href=\"https:\/\/calver.org\/\"><em>Calendar Versioning<\/em> (CalVer) scheme<\/a> to improve our communication with users and ease transitions between <em>fMRIPrep<\/em> releases. Under this versioning system, each <em>fMRIPrep<\/em> release follows the structure of <code>YY.MINOR.MICRO<\/code>, where <code>YY<\/code> are the last two digits of the calendar year.<br \/>\nSpecifically, this enables:<\/p>\n<ul>\n<li>Providing users (and developers) an instant, albeit rough, idea of how recent or old a version is.<\/li>\n<li>Guaranteeing that each minor (<em>feature<\/em>) release series maintains compatibility across micro (<em>bug-fix<\/em>) releases.<\/li>\n<\/ul>\n<p>One popular question over the years has been:<\/p>\n<blockquote><p>I processed some of my data using version <em>A<\/em>, but can I process the rest using version <em>B<\/em>?<\/p><\/blockquote>\n<p>Since the integration of CalVer, each feature release is completely backwards compatible &#8211; so long as the <code>YY.MINOR<\/code> match. There will be no difference if later outputs are generated by newer bug-fix releases, like jumping from <code>20.0.0<\/code> to <code>20.0.7<\/code>. This decision ensures consistency across results without requiring a rerun of computations, while leveraging the ability to fetch bug-fixes as needed. A more comprehensive criteria of what is and is not deemed eligible for a bug-fix release can be found on the <a href=\"https:\/\/www.nipreps.org\/devs\/releases\/#bug-fix-releases\"><em>NiPreps<\/em> community website<\/a>.<\/p>\n<p>The lifespan of a feature release varies, depending on the development of new or compatibility-breaking changes. For users with previously acquired data, or small ongoing data, using the most recent feature release will suffice. However, for more ambitious longitudinal data collection, such as the NeuroMod or ABCD studies, this rapid turnover leaves something to be desired. This gap, originally raised via tweet, spawned the idea of providing a unique feature release dedicated to handling these cases.<\/p>\n<blockquote class=\"twitter-tweet\">\n<p lang=\"en\" dir=\"ltr\">Are you planning on having the equivalent of a long term service (LTS) release? Updating continuously the software in my lab is impractical for a number of reasons, and I would also like to have a &#8220;go to&#8221; version that is very well tested.<\/p>\n<p>\u2014 Pierre Bellec (@pierre_bellec) <a href=\"https:\/\/twitter.com\/pierre_bellec\/status\/1233395286493605888?ref_src=twsrc%5Etfw\">February 28, 2020<\/a><\/p><\/blockquote>\n<p><script async=\"\" src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"><\/script><\/p>\n<h3 id=\"long-term-support-lts-\">Long-Term Support (LTS)<\/h3>\n<p>An <em>fMRIPrep LTS<\/em> is a special feature release with a greatly expanded lifespan for maintenance. LTS releases are targeted as <em>community-driven<\/em> series, meaning that an LTS manager is nominated to serve as the chief maintainer for a specific duration, no less than one year. Community members may volunteer to assume maintainership after the initial period, or to maintain a new minor release series as an LTS. Before release, LTS series are tested more rigorously than ordinary, and should include all necessary enhancements needed at the time of release.<\/p>\n<p><strong>We&#8217;re excited to announce the first <em>fMRIPrep<\/em> LTS series, <code>20.2.0<\/code>, has been released!<\/strong> This LTS version will be kindly steered and maintained by the group of Dr. Basile Pinsard and Prof. Pierre Bellec at <a href=\"http:\/\/www.criugm.qc.ca\">CRIUGM<\/a> (Universit\u00e9 de Montr\u00e9al). The <code>20.2.0<\/code> LTS is planned for a window of <strong>4 years of support<\/strong> (until September 2024).<\/p>\n<hr>\n<h3 id=\"what-s-new-\">What&#8217;s new?<\/h3>\n<p>Some of the highlights of this release include:<\/p>\n<h4 id=\"revision-of-the-reproducibility-of-compcor-masks\">Revision of the reproducibility of <em>CompCor<\/em> masks<\/h4>\n<p>We slightly deviate from the <a href=\"10.1016\/j.neuroimage.2007.04.042\">original Behzadi et al. implementation<\/a>, to ensure consistency across results and reduce user errors.<\/p>\n<h6 id=\"-acompcor-\"><strong>aCompCor<\/strong><\/h6>\n<p>Masks are prepared in high-resolution, anatomical space before being projected to BOLD space. Instead of using binary erosion, a dilated GM map is generated. This should be equivalent to eroding the masks, except that the erosion only happens at direct interfaces with GM.<\/p>\n<h6 id=\"-tcompcor-\"><strong>tCompCor<\/strong><\/h6>\n<p>We have removed the heavy erosion of the brain mask as compares to previous <em>fMRIPrep<\/em> versions. This erosion was not part of the original proposal, and was a potential source of errors from Numpy complaining that it can&#8217;t take from an empty axis of an array. <em>fMRIPrep<\/em> implementation deviates from Behzadi&#8217;s in that we pick top 2% most variable pixels within the whole-brain mask (as opposed to the 2% slice-wise)<\/p>\n<h4 id=\"updates-to-derivatives\">Updates to derivatives<\/h4>\n<p>Now that general derivatives are <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/v1.4.0\/05-derivatives\/01-introduction.html\">officially supported by the BIDS specification<\/a> as of BIDS 1.4.0, <em>fMRIPrep<\/em> has synchronized accordingly.<br \/>\nGood news, there were only a few changes:<\/p>\n<p>1) <code>*desc-confounds_regressors*<\/code> have been renamed to <code>*desc-confounds_timeseries*<\/code>.<br \/>\n2) A top level <code>.bidsignore<\/code> was added to <em>fMRIPrep<\/em>&#8216;s output directory.<\/p>\n<p>Additionally, the BOLD-anatomical transforms are now saved by default within the participant&#8217;s <code>func<\/code> directory.<\/p>\n<h4 id=\"runtime-improvements-for-large-datasets\">Runtime improvements for large datasets<\/h4>\n<p>We found that one chokepoint of previous versions of <em>fMRIPrep<\/em> was during the indexing of the BIDS dataset with a large number of files. We added the option to provide a pre-indexed database, as well as a helper CLI and <a href=\"https:\/\/fmriprep.org\/en\/20.2.0\/faq.html#how-to-decrease-fmriprep-runtime-when-working-with-large-datasets\">directions on how to use it<\/a>.<\/p>\n<h4 id=\"improvements-to-multi-echo-processing\">Improvements to multi-echo processing<\/h4>\n<ul>\n<li>Ensure motion correction and fieldwarp are not applied multiple times.<\/li>\n<li>Allow the use of single-band reference files.<\/li>\n<\/ul>\n<h4 id=\"all-the-goodies-from-20-1-x-series\">All the goodies from 20.1.x series<\/h4>\n<p>The 20.1.x series integrated a long list of substantial changes. The reason being that 20.1 was meant to be the first LTS release. However, to keep up with our RERO principle and to allow for a more thorough testing, the development team decided to transfer the LTS qualification over to <em>fMRIPrep<\/em> 20.2.<\/p>\n<p>For a comprehensive list of what&#8217;s changed, you can view the <a href=\"https:\/\/github.com\/poldracklab\/fmriprep\/blob\/20.2.0\/CHANGES.rst#2020-september-28-2020\">full log<\/a>.<\/p>\n<hr>\n<p>Thank you for using fMRIPrep!<br \/>\nAs always, if you encounter any issues with this release, please let us know by posting an issue on our <a href=\"https:\/\/github.com\/poldracklab\/fmriprep\/issues\/new\/choose\">GitHub page<\/a>!<\/p>\n<p>We are an open community &#8211; <a href=\"https:\/\/www.nipreps.org\/community\">get involved!<\/a><\/p>\n","protected":false},"excerpt":{"rendered":"<p>fMRIPrep: Versioning and Long-Term Support As fMRIPrep continues to mature, we at the development team would like to take a moment to look at where we&#8217;ve been and where we&#8217;re going. Its mission of producing &#8220;analysis-grade&#8221; (or &#8220;sushi-grade&#8221;) data has proven useful, as evident by the sizeable amount of adoption within the brain-MRI community, and [&hellip;]<\/p>\n","protected":false},"author":4,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_exactmetrics_skip_tracking":false,"_exactmetrics_sitenote_active":false,"_exactmetrics_sitenote_note":"","_exactmetrics_sitenote_category":0,"footnotes":""},"categories":[6],"tags":[],"class_list":["post-1097","post","type-post","status-publish","format-standard","hentry","category-blog"],"_links":{"self":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts\/1097","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/users\/4"}],"replies":[{"embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/comments?post=1097"}],"version-history":[{"count":3,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts\/1097\/revisions"}],"predecessor-version":[{"id":1103,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts\/1097\/revisions\/1103"}],"wp:attachment":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/media?parent=1097"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/categories?post=1097"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/tags?post=1097"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}