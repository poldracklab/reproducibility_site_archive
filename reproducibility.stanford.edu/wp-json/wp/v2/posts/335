{"id":335,"date":"2018-02-22T02:19:06","date_gmt":"2018-02-22T02:19:06","guid":{"rendered":"http:\/\/reproducibility.stanford.edu\/?p=335"},"modified":"2021-03-26T21:46:47","modified_gmt":"2021-03-26T21:46:47","slug":"bids-tutorial-series-part-1a","status":"publish","type":"post","link":"https:\/\/reproducibility.stanford.edu\/bids-tutorial-series-part-1a\/","title":{"rendered":"BIDS Tutorial Series: Introductory Walkthrough"},"content":{"rendered":"<p style=\"text-align: left;\"><b>Introduction<\/b><\/p>\n<p><span style=\"font-weight: 400;\">Welcome to part 1A of the tutorial series \u201cGetting Started with BIDS\u201d. The tutorial series will introduce you to converting brain data into the BIDS organizational standard, provide an example of how to convert a dataset into BIDS (manually and an automated solution), and examine different off-the-shelf automated solutions. This tutorial will show a detailed step-by-step organizational guide to convert DICOMs into a BIDS validated dataset. The step-by-step guide will iteratively add one modality at a time until the full dataset is organized and validated. Even though performing the conversion manually is not expected we show it here for educational purposes. An automated solution is strongly recommended. An automated custom solution is discussed in the <a href=\"http:\/\/reproducibility.stanford.edu\/bids-tutorial-series-part-1b\/\">next part of the tutorial series<\/a>. Throughout this tutorial series portion, we will be using DICOMs from the <a href=\"http:\/\/fcon_1000.projects.nitrc.org\/indi\/pro\/eNKI_RS_TRT\/FrontPage.html\">Nathan Kline Institute (NKI) Rockland Sample &#8211; Multiband Imaging Test-Retest Pilot Dataset<\/a>. We will be following the specifications described in the <a href=\"https:\/\/github.com\/bids-standard\/bids-website\/blob\/gh-pages\/old_website\/bids_spec1.0.2.pdf\">BIDS Specification version 1.0.2<\/a><\/span><span style=\"font-weight: 400;\">. The next parts of this tutorial series will examine an automated custom solution and off-the-shelf solutions to consider using to convert your dataset into the BIDS standard.\u00a0<\/span><\/p>\n<p>For surfacing questions, we please ask if you may direct them to\u00a0<a href=\"https:\/\/neurostars.org\/tag\/bids\">NeuroStars<\/a> with the \u201cbids\u201d tag. NeuroStars is an active platform with many BIDS experts.<\/p>\n<p><span style=\"font-weight: 400;\">Table of Contents<br \/>\nA. <a href=\"#man\">Manual conversion<\/a><\/span><\/p>\n<ol>\n<li><a href=\"#man1\">Download data<\/a><\/li>\n<li><a href=\"#man2\">Folder creation<\/a><\/li>\n<li><a href=\"#man3\">Dataset_description file<\/a><\/li>\n<li><a href=\"#man4\">Download MRIcroGL<\/a><\/li>\n<li><a href=\"#man5\">Create anatomical folders and convert dicoms<\/a><\/li>\n<li><a href=\"#man6\">Rename anatomical files<\/a><\/li>\n<li><a href=\"#man7\">Organize anatomical files and validate<\/a><\/li>\n<li><a href=\"#man8\">Create diffusion folders and convert dicoms<\/a><\/li>\n<li><a href=\"#man9\">Rename diffusion files<\/a><\/li>\n<li><a href=\"#man10\">Organize diffusion files and validate<\/a><\/li>\n<li><a href=\"#man11\">Create functional folders and convert dicoms<\/a><\/li>\n<li><a href=\"#man12\">Rename and organize functional files<\/a><\/li>\n<li><a href=\"#man13\">Task event tsv files<\/a><\/li>\n<li><a href=\"#man14\">Fix errors<\/a><\/li>\n<li><a href=\"#man15\">Add participant and check warnings<\/a><\/li>\n<\/ol>\n<p><a id=\"man\"><\/a><span style=\"font-weight: 500;\"><strong>1A. Manual conversion of DICOM images to BIDS<\/strong><\/span><\/p>\n<p><strong><a id=\"man1\"><\/a>Step 1.<\/strong> To begin, please navigate to the <a href=\"http:\/\/fcon_1000.projects.nitrc.org\/indi\/pro\/eNKI_RS_TRT\/FrontPage.html\">NKI-RS Multiband Imaging Test-Retest Pilot Dataset<\/a> and scroll down to the bottom of the page to download the DICOM images for participants 2475376 and 3893245.<\/p>\n<p><strong>Note<\/strong>: If you are having problems downloading this dataset, there is a <a href=\"https:\/\/github.com\/bids-standard\/bids-starter-kit\/wiki\/Tutorials-FAQ\">tutorial<\/a>\u00a0illustrating\u00a0how to download the data and a <a href=\"https:\/\/neurostars.org\/t\/nki-rs-multiband-imaging-test-retest-pilot-dataset-access\/4655\">NeuroStars thread<\/a>.<\/p>\n<p><strong><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/NKI_website_startingpoint-1.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-367 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/NKI_website_startingpoint-1.png\" alt=\"NKI_website_startingpoint\" width=\"470\" height=\"261\" \/><\/a><\/strong><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/NKI-dicom-download-ARROW.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-431 alignleft\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/NKI-dicom-download-ARROW.jpg\" alt=\"NKI dicom download-ARROW\" width=\"431\" height=\"206\" \/><\/a><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/NKI-Download-2-sample-subjects.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-459 alignnone\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/NKI-Download-2-sample-subjects.png\" alt=\"NKI Download 2 sample subjects\" width=\"173\" height=\"253\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man2\"><\/a><strong>Step 2.<\/strong> Once the DICOMs are downloaded, please create a folder with what the dataset is called and create a Dicom directory within this. In this case, our dataset is called BIDS_NKI_walkthrough. Then put the participant folders containing the DICOMs into that folder. The folder structure can be seen below.<\/span><\/p>\n<p><span style=\"font-weight: 400;\"><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-Dicom-create.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-448 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-Dicom-create.png\" alt=\"Man Dicom create\" width=\"453\" height=\"98\" \/><\/a><\/span><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-Dicom-with-both-subjs.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-447 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-Dicom-with-both-subjs.png\" alt=\"Man Dicom with both subjs\" width=\"458\" height=\"369\" \/><\/a><\/p>\n<p>Now, create a Nifti folder at the same level as the Dicom folder, pictured below.<\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-create-Nifti-folder.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-446 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-create-Nifti-folder.png\" alt=\"Man create Nifti folder\" width=\"477\" height=\"121\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man3\"><\/a><strong>Step 3.<\/strong> Then we need to create the <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/03-modality-agnostic-files.html#dataset_descriptionjson\">dataset_description.json<\/a> file. There is an <a href=\"https:\/\/jsoneditoronline.org\/\">online json editor<\/a> that can help create this file. Once the json file is written, one can save -&gt; save to disk. Then move this file to within the Nifti folder. The dataset_description.json file only needs to be made once. At this time, it is optional to add a <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/03-modality-agnostic-files.html#participants-file\">participant file<\/a>, <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/03-modality-agnostic-files.html#readme\">README<\/a>, or <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/03-modality-agnostic-files.html#changes\">CHANGES<\/a>.\u00a0Learn more about\u00a0<a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/02-common-principles.html#keyvalue-files-dictionaries\">json files<\/a>.\u00a0<\/span><\/p>\n<p><span style=\"font-weight: 400;\"><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/json-online-editor-with-completed-dataset-json.png\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-369\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/json-online-editor-with-completed-dataset-json.png\" alt=\"json online editor with completed dataset json\" width=\"691\" height=\"173\" \/><\/a><\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-datasetdescrip-in-Nifti.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-445 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-datasetdescrip-in-Nifti.png\" alt=\"Man datasetdescrip in Nifti\" width=\"410\" height=\"117\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man4\"><\/a><strong>Step 4.<\/strong> Now, please download <a href=\"https:\/\/www.nitrc.org\/projects\/mricrogl\/\">MRIcroGL<\/a>. This will allow one to convert the dicom files to nifti and the sidecar json files through a GUI. \u00a0<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/nitrc-dl-MRIcroGL.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-411 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/nitrc-dl-MRIcroGL.png\" alt=\"nitrc dl MRIcroGL\" width=\"589\" height=\"338\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">At this step, we will be breaking down the process of building the validated BIDS dataset by taking participant 2475376 and iteratively adding a modality once the previous modality has been validated. This means we will first go through the process of validating this dataset using 1 participant with anatomical scans. Next adding in the diffusion scans. Lastly adding in the functional scans.<\/span><\/p>\n<p><strong><a id=\"man5\"><\/a>Step 5.<\/strong> Before converting the anatomical scans, we will be creating the folder structure in the Nifti directory. To do this, we create a sub-2475376 folder. Within that a ses-1 folder and in that an anat folder. This can be visualized below.<\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-sub-structure.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-444 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-sub-structure.png\" alt=\"Man sub structure\" width=\"359\" height=\"136\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">To begin conversion, we will take participant 2475376\u2019s anat folder. <\/span><\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-413 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/sub247_justanat.png\" alt=\"sub247_justanat\" width=\"329\" height=\"257\" \/><\/p>\n<p><span style=\"font-weight: 400;\">To open the converter dcm2nii, please go to the MRIcroGL folder from the download above, click MRIcro, and click Import -&gt; Convert DICOM to NIfTI. Dcm2nii GUI should appear.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/contents-of-dcm2niix-ARROW.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-432 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/contents-of-dcm2niix-ARROW.jpg\" alt=\"contents of dcm2niix-ARROW\" width=\"470\" height=\"374\" \/><\/a><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/import-dcm2nii.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-371 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/import-dcm2nii.png\" alt=\"import dcm2nii\" width=\"376\" height=\"57\" \/><\/a><\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-370 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/dcm2nii.png\" alt=\"dcm2nii\" width=\"442\" height=\"200\" \/><\/p>\n<p><span style=\"font-weight: 400;\">Listed below is the default and different options for choosing the Output name. We used the default for this conversion.<a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/dcm2nii-naming-options.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-462 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/dcm2nii-naming-options.png\" alt=\"dcm2nii naming options\" width=\"433\" height=\"122\" \/><\/a><\/span>An example of the of the output filename is shown in the GUI on the first line. In the picture above the example output filename is: \u2018\/myfolder_MPRAGE.nii\u2019.<\/p>\n<p><span style=\"font-weight: 400;\">The output folder will be the Nifti folder. \u00a0For input please select the participant directory. One may have to try this process a few times to find the best output name to work with. It is recommended that [participant number]_[protocol] be the output of dcm2nii. The output of performing the dcm2nii conversion are nii and json files. The nii file is the brain image and the sidecar json file stores the metadata to describe the nii file.\u00a0<\/span><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/dataset_descrip.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-400 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/dataset_descrip.png\" alt=\"dataset_descrip\" width=\"296\" height=\"183\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man6\"><\/a><a id=\"aman6\"><\/a><strong>Step 6.<\/strong> Now we are ready to rename the nifti and json file names.\u00a0<\/span><span style=\"font-weight: 400;\">The template for\u00a0<a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/04-modality-specific-files\/01-magnetic-resonance-imaging-data.html#anatomy-imaging-data\">naming anatomical images<\/a>. The not bracketed elements are required and the bracketed elements are optional. (i.e. modality label is required, acq is optional). Note that the nifti and json file have the same filename, the crop does not have a json file because the json file describes this nifii image as well.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-Anat-rename.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-450 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-Anat-rename.jpg\" alt=\"Man Anat rename\" width=\"433\" height=\"50\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man7\"><\/a><strong>Step 7.<\/strong> We are ready to organize the nii and json files into the appropriate folder. In this case, the three files we renamed will be placed in the ses-1\/anat folder.\u00a0One can try to <a href=\"http:\/\/bids-standard.github.io\/bids-validator\/\">validate<\/a> the dataset.<\/span><\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-399 alignleft\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/anat-organized.png\" alt=\"anat organized\" width=\"356\" height=\"219\" \/><\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-453 alignright\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-Anat-upload.png\" alt=\"Man Anat upload\" width=\"361\" height=\"334\" \/><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Bids-valid-dataset.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-419 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Bids-valid-dataset.png\" alt=\"Bids valid dataset\" width=\"307\" height=\"32\" \/><\/a><a id=\"man8\"><\/a><strong>Step 8.<\/strong> We will now be adding in the diffusion scans. The diffusion scans can be found in session 1 and 2 folders marked DTI_mx_137 within the originally downloaded subject folder. We will now take the two diffusion folders, move them into our Dicom folder, and convert the images. For conversion, input the session folder and output the Nifti folder. One will run the converter twice, once for each session folder. This will output the nii, json, bval, and bvec files. In addition, please create a ses-2 folder within the subject folder in the Nifti folder and add a dwi folder to each session.<\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/raw-diff-in-Dicom.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-397 alignleft\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/raw-diff-in-Dicom.png\" alt=\"raw diff in Dicom\" width=\"376\" height=\"188\" \/><\/a><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/converted-diff-ses2-dwi-folder.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-396 alignnone\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/converted-diff-ses2-dwi-folder.png\" alt=\"converted diff dwi folder\" width=\"344\" height=\"367\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man9\"><\/a><strong>Step 9.<\/strong> We are ready to <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/04-modality-specific-files\/01-magnetic-resonance-imaging-data.html#diffusion-imaging-data\">rename the diffusion scans<\/a>. In this case, there are two diffusion scans, one for each session. Pictured below is the renaming of each session to the BIDS filenames for the nii, json, bval, and bvec. Notice that within the same session number, all the files have the same filename.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Diff-namechange-arrow.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-461 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Diff-namechange-arrow.jpg\" alt=\"Diff namechange arrow\" width=\"396\" height=\"110\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man10\"><\/a><strong>Step 10.<\/strong> Now we can organize the diffusion scans into their appropriate session folder and try <a href=\"http:\/\/bids-standard.github.io\/bids-validator\/\"> validating<\/a> this dataset.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/diff-organized.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-395 alignleft\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/diff-organized.png\" alt=\"diff organized\" width=\"348\" height=\"363\" \/><\/a><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-dwi-upload.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-454 alignright\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-dwi-upload.png\" alt=\"Man dwi upload\" width=\"376\" height=\"348\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Bids-valid-dataset.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-419 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Bids-valid-dataset.png\" alt=\"Bids valid dataset\" width=\"287\" height=\"30\" \/><\/a><a id=\"man11\"><\/a><strong>Step 11.<\/strong> We are ready to add in the functional scans to the Dicom directory. This will be the rest of the folders in the originally downloaded subject. The folders are: TfMRI_breathHold_1400, TfMRI_eyeMovementCalibration_645, TfMRI_eyeMovementCalibration_1400, TfMRI_visualCheckerboard_645, TfMRI_visualCheckerboard_1400, and the three RfMRI folders within the session1 and session2 folders. <\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/func-in-Dicom.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-394 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/func-in-Dicom.png\" alt=\"func in Dicom\" width=\"340\" height=\"339\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">Please convert the functional Dicom folders into the Nifti folder. This will output the nii and json files. In addition, please create func folders within both session folders. <\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/func-converted-Nifti.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-393 alignleft\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/func-converted-Nifti.png\" alt=\"func converted Nifti\" width=\"418\" height=\"460\" \/><\/a><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/folder-organization-func-.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-392 alignnone\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/folder-organization-func-.png\" alt=\"folder organization func\" width=\"232\" height=\"208\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man12\"><\/a><strong>Step 12.<\/strong> Now let\u2019s <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/04-modality-specific-files\/01-magnetic-resonance-imaging-data.html#task-including-resting-state-imaging-data\">name the functional filenames<\/a>. To complete this, one may look back at the <a href=\"http:\/\/fcon_1000.projects.nitrc.org\/indi\/pro\/eNKI_RS_TRT\/FrontPage.html\">NKI webpage<\/a> and identify the different tasks for the functional images. This will provide a better sense of how to name these files. We see that there are four different tasks: checkerboard, eye movement, breath hold, and rest. We also notice that there are different TR\u2019s for some tasks and the rest tasks have 2 session scans.\u00a0<\/span><span style=\"font-weight: 400;\">To break this down, we will go through each task separately.<\/span><\/p>\n<p><span style=\"font-weight: 400;\">Let\u2019s begin with the checkerboard task. <\/span><span style=\"font-weight: 400;\">We notice there are two different TR\u2019s. For TR=645ms, we define this as acq-TR645. Similarly, for TR=1400ms, we define this as acq-TR1400. The acq label was chosen because it is an acquisition difference between the scans. For determining session number, there is not a clear delineation of which session this scan was taken on. Therefore, we defined these scans into session 1, therefore ses-1 will be added as well. <\/span><\/p>\n<p><span style=\"font-weight: 400;\">Applying this, we can see how the name will be changed. Both the nii and json will have the same filename (this may be the rule-of-thumb for more beginner users, superusers may reference the <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/02-common-principles.html#the-inheritance-principle\"> Inheritance Principle<\/a>). Please note the <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/04-modality-specific-files\/01-magnetic-resonance-imaging-data.html#task-including-resting-state-imaging-data\">ordering of the filename<\/a>. This is not optional, <\/span><span style=\"font-weight: 400;\">the order described in the template has to be followed<\/span><span style=\"font-weight: 400;\">. (i.e. we could not have switched the placement of acq and task, the validator will fail this)<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-checker-namechange-arrow.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-460 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-checker-namechange-arrow.jpg\" alt=\"Func checker namechange arrow\" width=\"748\" height=\"64\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">Proceeding onto\u00a0renaming the eye movement calibrations. The filename will be similar to the checkerboard naming, with the main difference being the different task label.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-eye-namechange-arrow.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\"alignnone wp-image-487\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-eye-namechange-arrow.jpg\" alt=\"Func eye namechange arrow\" width=\"748\" height=\"60\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">Now for the breath hold task. The naming will be similar to the previous tasks, but there is only one TR.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-breath-namechange-arrow.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-451 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-breath-namechange-arrow.jpg\" alt=\"Func breath namechange arrow\" width=\"738\" height=\"34\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">Finally, the rest task. For this task we notice there is 3 different acquisitions (TR=645,1400, and 2500 with differing voxel size and duration). In addition, these are repeated sessions. Therefore, the session identified in the filename will correspond to what ses number to use (i.e. session 2 will be ses-2). The complete filenames are pictured below. Note the CAP image is the TR=2500ms, this can be found on the <a href=\"http:\/\/fcon_1000.projects.nitrc.org\/indi\/pro\/eNKI_RS_TRT\/Rest_CAP.pdf\">protocol sheet<\/a> <\/span><span style=\"font-weight: 400;\">. <\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-rest-namechange-arrow.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-434 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Func-rest-namechange-arrow.jpg\" alt=\"Func rest namechange arrow\" width=\"622\" height=\"213\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">We are ready to organize the files into the appropriate folder. The session 1 tasks will go into the ses-1\/func folder and session 2 tasks will go into ses-2\/func. The completed structure is pictured below.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/func-file-folder-organized.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-391 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/func-file-folder-organized.png\" alt=\"func file folder organized\" width=\"416\" height=\"703\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man13\"><\/a><strong>Step 13.<\/strong> With the files organized, we will now add the <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/04-modality-specific-files\/05-task-events.html\">task event .tsv<\/a> files to describe the task design. For this dataset, there will be five events.tsv files. There is 1 event file for breathhold and 2 for checkerboard and eyemovement (because there are 2 different acq, these event files will have the same content, but different filenames). Rest will not have an events.tsv file. If the events are consistent across the subjects, one can put the events file on the level where the dataset_description.json and subject folders are. If the events are different for each subject, then a sub-# and ses-# needs to precede task-&lt;TakeName&gt;_acq-TR#_events.tsv (i.e. sub-2475376_ses-1_task-Checkerboard_acq-TR1400_events.tsv) and placed at the nii and json level. For this case, since the task is consistent across subjects and sessions, we will put it on the dataset_description level. The contents of these files can be determined from looking at the stimulus design files on the <a href=\"http:\/\/fcon_1000.projects.nitrc.org\/indi\/pro\/eNKI_RS_TRT\/FrontPage.html\">NKI website<\/a>. <\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/good-checker-design-file.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-402 alignleft\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/good-checker-design-file.png\" alt=\"good checker design file\" width=\"402\" height=\"197\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/events-files.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-390 alignnone\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/events-files.png\" alt=\"events files\" width=\"340\" height=\"143\" \/><\/a><\/span><\/p>\n<p><strong><a id=\"man14\"><\/a>Step 14.<\/strong> We will now try and <a href=\"http:\/\/bids-standard.github.io\/bids-validator\/\">validate<\/a> this dataset.\u00a0<span style=\"font-weight: 400;\">One will receive 2 errors, pictured below. We will now go through fixing both these errors.<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/errors-manually.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-389 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/errors-manually.png\" alt=\"errors manually\" width=\"634\" height=\"166\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">Let\u2019s begin with the defining \u2018TaskName\u2019. To do this, we will be editing the functional scan\u2019s json files. There are <a href=\"https:\/\/bids-specification.readthedocs.io\/en\/stable\/04-modality-specific-files\/05-task-events.html\">required fields<\/a> that need to be present in each func json file. For this dataset, we notice upon opening the json\u2019s that they have defined repetition time and slice timing, but not task name. The task name <\/span><span style=\"font-weight: 400;\">needs<\/span><span style=\"font-weight: 400;\"> to be the same name given as the task-&lt;TaskName&gt; in the filename. For example sub-2475376_ses-1_task-Checkerboard_acq-TR645_bold ; the json will have \u201cTaskName\u201d: \u201cCheckerboard\u201d, as pictured below. <\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/TaskName-addchange-arrowed.jpg\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-421 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/TaskName-addchange-arrowed.jpg\" alt=\"TaskName addchange arrowed\" width=\"768\" height=\"190\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">Once that is complete, we can try <a href=\"http:\/\/bids-standard.github.io\/bids-validator\/\">validating<\/a> again and notice that a single error remains (Error 2 from above): SliceTiming cannot be greater than RepetitionTime. <\/span><\/p>\n<p><span style=\"font-weight: 400;\">To fix this error, we first need to understand what is causing this error. The source of this error can be traced back to the fact that this is a multiband imaging dataset. The GUI version of dcm2nii is an earlier version that was not able to properly record the slice timings for some multiband imaging files, causing an error in the slice timing. A <a href=\"http:\/\/www.mccauslandcenter.sc.edu\/crnl\/tools\/stc\">fix<\/a> for this error has been developed.<\/span><\/p>\n<p><span style=\"font-weight: 400;\">For this particular dataset, there is a <a href=\"https:\/\/github.com\/Chaogan-Yan\/DPABI\/tree\/master\/DPARSF\/Docs\">corrected time slicing<\/a> for each of the TR\u2019s.<\/span><\/p>\n<p><span style=\"font-weight: 400;\">To correct the slice timing error, one can copy the time slicing found on the github to the slice timing for each of the tasks json files (the files that need to be changed are identified in the error message) Be careful to divide by 1000 because those times are currently in milliseconds not seconds, we need them to be in seconds.\u00a0<\/span><\/p>\n<p><span style=\"font-weight: 400;\">After those numbers have been pasted in. One can run the <a href=\"http:\/\/bids-standard.github.io\/bids-validator\/\">validator<\/a>.\u00a0<\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-func-upload.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-455 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Man-func-upload.png\" alt=\"Man func upload\" width=\"437\" height=\"616\" \/><\/a><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Bids-valid-dataset.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-419 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/Bids-valid-dataset.png\" alt=\"Bids valid dataset\" width=\"354\" height=\"37\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\"><a id=\"man15\"><\/a><strong>Step 15.<\/strong> You have completed manually creating a BIDSified dataset for 1 subject across 2 sessions and 3 modalities! Now try to complete this same process again with participant 3893245. The only difference is that there is no session 1 for the diffusion scan. Pictured below is the structure for participant 3893245. <\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/389-manual-organized.png\"><img loading=\"lazy\" decoding=\"async\" class=\" wp-image-388 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/389-manual-organized.png\" alt=\"389 manual organized\" width=\"398\" height=\"533\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">We find after <a href=\"http:\/\/bids-standard.github.io\/bids-validator\/\">validating<\/a> there are 2 warnings (pictured below). The first warning is because there is no ses-1 dwi scan for participant 3893245. The second warning is because the time series length is different between the two subjects. These messages are warnings versus errors, therefore they can be interpreted as something to understand before moving on, but this is not an error and one can move on after understanding the reason for the warning. <\/span><\/p>\n<p><a href=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/warning-after-2subs.png\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-387 aligncenter\" src=\"http:\/\/reproducibility.stanford.edu\/wp-content\/uploads\/2018\/02\/warning-after-2subs.png\" alt=\"warning after 2subs\" width=\"689\" height=\"127\" \/><\/a><\/p>\n<p><span style=\"font-weight: 400;\">Now we will go through this same process again in the <a href=\"http:\/\/reproducibility.stanford.edu\/bids-tutorial-series-part-1b\/\">next part<\/a>, but walking through an automated custom solution.<\/span><\/p>\n<p><span style=\"font-weight: 400;\">This tutorial illustrated how to manually step-by-step convert DICOMs from the NKI Test-Retest dataset to a validated BIDS dataset. <a href=\"http:\/\/reproducibility.stanford.edu\/bids-tutorial-series-part-1b\/\">The next tutorial<\/a> will show how to complete this conversion using an\u00a0automated custom solution.\u00a0<\/span><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Introduction Welcome to part 1A of the tutorial series \u201cGetting Started with BIDS\u201d. The tutorial series will introduce you to converting brain data into the BIDS organizational standard, provide an example of how to convert a dataset into BIDS (manually and an automated solution), and examine different off-the-shelf automated solutions. This tutorial will show a [&hellip;]<\/p>\n","protected":false},"author":4,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"_exactmetrics_skip_tracking":false,"_exactmetrics_sitenote_active":false,"_exactmetrics_sitenote_note":"","_exactmetrics_sitenote_category":0,"footnotes":""},"categories":[6],"tags":[],"class_list":["post-335","post","type-post","status-publish","format-standard","hentry","category-blog"],"_links":{"self":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts\/335","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/users\/4"}],"replies":[{"embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/comments?post=335"}],"version-history":[{"count":116,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts\/335\/revisions"}],"predecessor-version":[{"id":1157,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/posts\/335\/revisions\/1157"}],"wp:attachment":[{"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/media?parent=335"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/categories?post=335"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/reproducibility.stanford.edu\/wp-json\/wp\/v2\/tags?post=335"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}